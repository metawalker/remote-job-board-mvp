<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Admin Settings</title>
</head>
<body>
    <h1>Admin Settings API Test</h1>
    <button onclick="testSettings()">Test Settings API</button>
    <div id="output"></div>

    <script>
// Generated by Copilot
async function testSettings() {
  const output = document.getElementById('output');
  output.innerHTML = '<p>Testing...</p>';
  
  try {
    // Test GET endpoint
    const getResponse = await fetch('/api/admin/settings', {
      method: 'GET',
      credentials: 'include'
    });
    
    console.log('GET status:', getResponse.status);
    const getData = await getResponse.json();
    console.log('GET data:', getData);
    
    let results = [`<h3>GET Result</h3>`, `Status: ${getResponse.status}`, `Success: ${getData.success}`];
    
    if (getData.success) {
      results.push(`Sources count: ${getData.settings.sources.length}`);
      results.push('<h4>Sources:</h4>');
      getData.settings.sources.forEach((source, index) => {
        results.push(`${index + 1}. ${source.name} - Enabled: ${source.enabled}`);
      });
      
      // Test POST with modified settings
      const modifiedSettings = { ...getData.settings };
      if (modifiedSettings.sources.length > 0) {
        // Toggle first source
        const originalEnabled = modifiedSettings.sources[0].enabled;
        modifiedSettings.sources[0].enabled = !originalEnabled;
        results.push(`<h3>POST Test</h3>`);
        results.push(`Toggling first source from ${originalEnabled} to ${modifiedSettings.sources[0].enabled}`);
        
        const postResponse = await fetch('/api/admin/settings', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify({ settings: modifiedSettings })
        });
        
        console.log('POST status:', postResponse.status);
        const postData = await postResponse.json();
        console.log('POST data:', postData);
        
        results.push(`POST Status: ${postResponse.status}`);
        results.push(`POST Success: ${postData.success}`);
        
        if (postData.success) {
          results.push('✓ POST request successful');
          
          // Verify the change
          const verifyResponse = await fetch('/api/admin/settings', {
            method: 'GET',
            credentials: 'include'
          });
          
          const verifyData = await verifyResponse.json();
          if (verifyData.success) {
            const newEnabled = verifyData.settings.sources[0].enabled;
            results.push(`Verified enabled status: ${newEnabled}`);
            if (newEnabled === modifiedSettings.sources[0].enabled) {
              results.push('✓ Change was successfully persisted');
            } else {
              results.push('✗ Change was not persisted');
            }
          }
        } else {
          results.push(`✗ POST request failed: ${postData.error}`);
        }
      }
    } else {
      results.push(`✗ GET request failed: ${getData.error}`);
    }
    
    output.innerHTML = results.map(r => `<p>${r}</p>`).join('');
    
  } catch (error) {
    console.error('Test error:', error);
    output.innerHTML = `<p>Error: ${error.message}</p>`;
  }
}
    </script>
</body>
</html>
