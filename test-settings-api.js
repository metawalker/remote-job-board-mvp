// Generated by Copilot
// Test the admin settings API endpoints

async function testSettingsAPI() {
  console.log('Testing settings API...')
  
  try {
    // Test GET endpoint
    const getResponse = await fetch('/api/admin/settings', {
      method: 'GET',
      credentials: 'include'
    })
    
    console.log('GET status:', getResponse.status)
    const getData = await getResponse.json()
    console.log('GET data:', getData)
    
    if (getData.success) {
      console.log('✓ GET request successful')
      console.log('Sources count:', getData.settings.sources.length)
      
      // Test POST with modified settings
      const modifiedSettings = { ...getData.settings }
      if (modifiedSettings.sources.length > 0) {
        // Toggle first source
        modifiedSettings.sources[0].enabled = !modifiedSettings.sources[0].enabled
        console.log('Modified first source enabled to:', modifiedSettings.sources[0].enabled)
        
        const postResponse = await fetch('/api/admin/settings', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify({ settings: modifiedSettings })
        })
        
        console.log('POST status:', postResponse.status)
        const postData = await postResponse.json()
        console.log('POST data:', postData)
        
        if (postData.success) {
          console.log('✓ POST request successful')
          
          // Verify the change
          const verifyResponse = await fetch('/api/admin/settings', {
            method: 'GET',
            credentials: 'include'
          })
          
          const verifyData = await verifyResponse.json()
          if (verifyData.success) {
            console.log('Verified enabled status:', verifyData.settings.sources[0].enabled)
            if (verifyData.settings.sources[0].enabled === modifiedSettings.sources[0].enabled) {
              console.log('✓ Change was successfully persisted')
            } else {
              console.log('✗ Change was not persisted')
            }
          }
        } else {
          console.log('✗ POST request failed:', postData.error)
        }
      }
    } else {
      console.log('✗ GET request failed:', getData.error)
    }
    
  } catch (error) {
    console.error('Test error:', error)
  }
}

// Run the test
testSettingsAPI();
